# Sprints v2

## Briefing
The hourly estimates are one of our core parts of the [sprint planning process](https://handbook.opencraft.com/en/latest/sprint_planning_agenda/). We use them to determine our capacity by comparing commitments with goals. This way we can be precise about the amount of work that should be added or discarded. As Jira does not offer an intuitive way to plan our sprints, we have decided to create an internal application called [Sprints](https://sprints.opencraft.com), which is our main tool for doing sprint planning sessions. <br/>
At the moment the documentation for Sprints is in its [README](https://github.com/open-craft/sprints#sprints). <br/>
We have added a [UX] suffix to some steps below. They contain some questions about the best way to present a specific feature to users.

## Phase 1
The discovery for the first phase can be found [here](https://docs.google.com/document/d/1AYdToLiH3zEGbO4k983GHcRi8Nh8sx9cWVkJuMbHvOg). This part was focused on the initial steps of automating the [asynchronous sprint planning process](https://handbook.opencraft.com/en/latest/sprint_planning_agenda/).

## Phase 2

### Migrate to GitLab
As we have decided to move our repositories to GitLab, we could prioritize this step to have all merge requests in one place. This step includes:
1. [Reusing](https://gitlab.com/opencraft/dev/crafty-bot/-/blob/master/.gitlab-ci.yml) the CI/CD pipelines from the [crafty-bot](https://gitlab.com/opencraft/dev/crafty-bot) repository and extending them with AWS S3 and AWS CloudFront support.
1. Using GitLab container registry instead of DockerHub.
1. Creating description templates for issues and merge requests.
1. Setting up security pipelines.

**Estimate**: 16h


### Epic Update Reminder
On Thursday/Friday/Monday (the date is in flux with the changes to the async planning process), Crafty should use a Jira comment to remind the epic owner of every active epic to post an epic update. The functionality should be similar to the existing [EpicUpdateReminder.groovy](https://gitlab.com/opencraft/dev/jira-scripts/-/blob/master/EpicUpdateReminder.groovy) script, but implemented in Sprints; the old groovy script can then be retired. <br/>
Document this directive in our docs.

**Estimate**: 4h


### Epic Due Date Reminder
Every day, the `Sprints` app should check if any active epics are about to reach their due date or are now "overdue" and then have Crafty leave a Jira comment for the epic owner to remind them about the upcoming deadline or ask them to update the due date. The functionality should be similar to the existing [EpicDueDateReminder.groovy](https://gitlab.com/opencraft/dev/jira-scripts/-/blob/master/EpicDueDateReminder.groovy) script, but implemented in Sprints; the old groovy script can then be retired. <br/>
Document this directive in our docs.

**Estimate**: 3h


### Add Redux Toolkit
Adding [Redux Toolkit](https://redux-toolkit.js.org/) will allow us to enable Redux DevTools Extension and greatly simplify reducers and actions. <br/>
The initial estimate has been bumped because we tried enabling this as part of another ticket, but this will require some changes due to the necessity of preserving state immutability (best practices). Additionally, there were some initial problems with nightly versions of Firefox due to the new functionality of having a limit of data that can be kept in Local Storage. We should make sure that this won't break on any browser.

**Estimate**: 7h


### Improve UI/UX [UX]
**[UX]** We would like to make `Sprints` more intuitive and approachable in a way that would help to make our internal processes smoother and to encourage others to use this tool.

**Estimate**: TBD (unknown frontend scope, this will likely be split into multiple tasks)


### Abort pending requests after changing dates [UX]
When trying to change the date range for the sustainability data, the page starts loading data when either the start or end date is changed. In some scenarios, when the start date is in the future (e.g. I am trying to view the data for December after viewing the data for November), this causes the data to be loaded before the range is properly changed. After that, changing the end date doesn't update the data again. Only a page refresh fixes it.

**[UX]** We have two options here:
1. Abort pending requests after switching the date.
2. Add a button to click on for refreshing the data after changing dates.

**Estimate**: 4h


### Improve documentation
Move the documentation out to ReadTheDocs, improve documentation (especially for the sustainability), add screenshots to describe each screen and feature.

**Estimate**: 11h


### Improve error handling [UX]
Ensure that data retrieved from Google API cannot raise an unhandled exception. This point relates mostly to spreadsheets and API calls (sometimes Google breaks), for which using the wrong syntax in specific fields prevents the `Sprints` dashboard from rendering at all. We should still log such inconsistencies (e.g. to Sentry), but they shouldn't break the endpoints.

**Estimate**: 7h


### Hide Sustainability dashboard by default [UX]
Most of the time spent in Sprints is related to the Sprints dashboard. Therefore, to reduce the number of queries, we can hide the Sustainability dashboard by default and display it only when a button is clicked by the user.

**[UX]** What would be the best way to toggle the sustainability dashboard? Should we toggle it with a button, add a checkbox for this, or something else? Should we keep the user's choice in Local Storage or Session Storage? For reference, we are using Session Storage to keep `From` and `To` dates set for the `Sustainability Dashboard`.  

**Estimate**: 2h


### Gather and address feedback
Previous iterations of Sprints and Sustainability dashboards lead to heavy discussions. Therefore, we should plan plenty of time for gathering feedback, applying smaller changes, and preparing tickets for the potential small iteration after completing the MVP.

**Estimate**: 26h


### Automate sprint completion
Automatically complete the sprint. This would be an equivalent of pressing the `Complete Sprint` button, but first, we should determine what to do with tickets that are not `Ready for a sprint`. This can be discussed during the "Gather and address feedback" step.   

**Estimate**: TBD (unknown scope)


### Budget enhancements [UX]
Some clients have a strict monthly cap on their billable hours that spans across multiple accounts - support and development. However, apart from setting up a budget splitting that cap based on past numbers, there is no way to set a cap for multiple accounts combined.
This can be split into two different problems, described below.

#### Multi-account budgets
Some other clients have the budgets set for all of their accounts combined. Therefore, it's tricky to accurately track the usage of each budget, as it is going to require occasional tweaks to the proportions used for each account. We can introduce artificial accounts in Sprints, that will consist of multiple accounts. E.g. "Client Support", "Client Maintenance", and "Client Theming" will be listed as one account - "Client", with one budget set (as defined in this spreadsheet).
We could also spend some time extracting current budgets' dates in Sprints to separate models to make managing them easier - so that all changes to a single budget would be done from a single Django admin page.

**[UX]** How can we present multi-account budgets on the `Sustainability Dashboard`? We should be able to check the numbers from the sub-accounts too (e.g. have an accordion with sub-accounts as its content).

**Estimate**: 16h + TBD (unknown frontend scope)

#### Monthly caps
For some budgets, we cannot go beyond some number of hours per month. We could mark such budgets as "strict", which would indicate that time spent over a limit in a specific month would be counted as an overhead.
However, this is going to make YTD and period calculations much more complex. Also, we would need a proper way to indicate a difference between standard and "strict" budget on the board.

**[UX]** How can we represent strict caps for budgets on the `Sustainability Dashboard`? Note: we're currently using a tooltip displayed while hovering over an account to see its monthly budgets.

**Rough estimate**: 24h + TBD (unknown frontend scope)


### Cell budgets (allow to split an account budget between cells)
Currently, budgets are set per account. Now that we use several cells, each cell may want to have its budget (for instance for OC-MEETINGS). When viewing a cellâ€™s dashboard, the overhead in each account needs to be calculated based on this cell budget, not on the global account budget.
Implementation ideas (to be discussed):
- Having a global budget (as of now) and then storing the percentages: 30%+30%+40%.
- Explicitly setting the hours: 50+80+0. Then we either need to verify that the sum of the cell budgets matches the account budget that we currently set, or we get rid of the current budget field and calculate it via the sum of the cell budgets.
- Creating a different account for each cell. E.g. OC-FAL-MEETINGS, OC-SE-MEETINGS, OC-BB-MEETINGS, and continue using the current dashboard.

**Estimate**: TBD (unknown frontend scope)

### Show sustainability ratio of the next sprint [UX]
Create a new table that will show the division of billable/non-billable tasks in the upcoming sprint. Example table:

| Units        | Total | Non-cell | Billable cell | Non-billable cell | % non-billable cell |
| :----------: | :---: | :------: | :----------:  | :--------------:  | :-----------------: |   
| Story points | 72    | 10       | 40            | 22                | 35%                 |
| Hours        | 894   | 165      | 472           | 257               | 35%                 |

**[UX]** How can we add this without making the page cluttered?

**Estimate**: TBD (unknown frontend scope)


### Add predictions to the Sustainability dashboard [UX]
Add a toggle to turn on predictions on the Sustainability board - if on, the numbers will indicate the sustainability calculated with an assumption that from the current day to the selected end date we are going to use 100% of all defined budgets.

**[UX]** How can we add this to make this feature intuitive?

**Rough estimate**: 20h


### Easier installation
One-liner installation, without prerequisites and sensible defaults, is going to be tricky here, as Sprints won't work without setting many variables, like Jira credentials. Therefore, based on the approach introduced by [Discourse](https://github.com/discourse/discourse/blob/master/docs/INSTALL-cloud.md#install-discourse), we can create a new repository that contains a base `docker-compose.yml` file, and a helper bash script that will generate configurations with variables provided by the user. It should also contain the [script](https://github.com/open-craft/ansible-playbooks/blob/master/playbooks/roles/sprints/files/deploy.sh) to upgrade an instance.

**Rough estimate**: 14h
